import{r as d}from"./index.BVOCwoKb.js";var v={exports:{}},b={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j;function N(){if(j)return b;j=1;var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(a,e,l){var x=null;if(l!==void 0&&(x=""+l),e.key!==void 0&&(x=""+e.key),"key"in e){l={};for(var o in e)o!=="key"&&(l[o]=e[o])}else l=e;return e=l.ref,{$$typeof:n,type:a,key:x,ref:e!==void 0?e:null,props:l}}return b.Fragment=r,b.jsx=i,b.jsxs=i,b}var y;function R(){return y||(y=1,v.exports=N()),v.exports}var t=R();function k({agvs:n,mapSize:r}){const i=d.useRef(null);return d.useEffect(()=>{const a=i.current;if(!a)return;const e=a.getContext("2d");if(!e)return;const l=window.devicePixelRatio||1;a.width=r*l,a.height=r*l,a.style.width=`${r}px`,a.style.height=`${r}px`,e.setTransform(l,0,0,l,0,0),e.clearRect(0,0,r,r);const x=20;e.strokeStyle="#ffffff20",e.lineWidth=1;for(let o=0;o<=r;o+=x)e.beginPath(),e.moveTo(o,0),e.lineTo(o,r),e.stroke();for(let o=0;o<=r;o+=x)e.beginPath(),e.moveTo(0,o),e.lineTo(r,o),e.stroke();Object.values(n).forEach(o=>{const{x:u,y:h,target:s,agvId:c}=o,f=u/200*r,m=h/200*r;if(e.fillStyle="#3b82f6",e.beginPath(),e.arc(f,m,8,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.font="bold 11px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(String(c),f,m),s){const g=s.x/200*r,p=s.y/200*r;e.strokeStyle="#f97316",e.lineWidth=2,e.beginPath(),e.moveTo(f,m),e.lineTo(g,p),e.stroke();const w=8;e.fillStyle="#ef4444",e.fillRect(g-w/2,p-w/2,w,w)}})},[n,r]),t.jsx("canvas",{ref:i,className:"rounded-lg border border-white/20 bg-white/10 shadow-inner"})}function E({agv:n,onSendTarget:r}){const[i,a]=d.useState({x:"",y:""}),e=n.battery<=20,l=d.useCallback(u=>{const{name:h,value:s}=u.target;a(c=>({...c,[h]:s}))},[]),x=d.useCallback(u=>{u.preventDefault();const h=Number(i.x),s=Number(i.y);!isNaN(h)&&!isNaN(s)&&(r(n.agvId,h,s),a({x:"",y:""}))},[i,r,n.agvId]),o=e?"bg-red-500":"bg-green-400";return t.jsxs("div",{className:`\r
        w-full flex flex-col p-4 \r
        bg-white/20 backdrop-blur-sm border border-white/30\r
        rounded-xl shadow transition-all duration-300 min-h-[160px]\r
        hover:border-blue-400 hover:bg-white/30 cursor-pointer`,children:[t.jsxs("div",{className:"w-full flex items-center mb-2",children:[t.jsx("div",{className:`\r
            w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center\r
            text-white font-semibold text-base border-2 border-blue-400`,children:n.agvId}),t.jsxs("div",{className:"ml-3 flex-1",children:[t.jsxs("div",{className:"text-white font-semibold text-sm",children:["AGV #",n.agvId]}),t.jsx("div",{className:"mt-1 w-full h-2 bg-white/25 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${o}`,style:{width:`${n.battery}%`}})}),t.jsxs("div",{className:`text-xs font-semibold mt-[2px] ${e?"text-red-300":"text-white/70"}`,children:[n.battery,"%"]})]})]}),t.jsxs("div",{className:"w-full text-left mb-2 text-sm text-white leading-tight",children:["Posición:"," ",t.jsxs("span",{className:"font-mono",children:[Math.round(n.x),", ",Math.round(n.y)]}),n.target&&t.jsxs("div",{className:"text-xs text-orange-300 font-mono",children:["Destino: ",Math.round(n.target.x),", ",Math.round(n.target.y)]})]}),t.jsxs("form",{className:"flex items-center justify-between gap-2",onSubmit:x,children:[["x","y"].map(u=>t.jsx("input",{name:u,type:"number",placeholder:u.toUpperCase(),className:`\r
              w-16 h-9 px-2 text-sm font-semibold text-white bg-transparent\r
              border border-white/50 rounded placeholder-white/50\r
              focus:outline-none focus:ring focus:ring-blue-300`,value:i[u],onChange:l,min:0,max:200,required:!0},u)),t.jsx("button",{type:"submit",className:`\r
            w-full px-3 py-2 text-sm font-semibold text-white\r
            bg-gradient-to-r from-blue-600 to-blue-400 rounded shadow\r
            hover:opacity-90 transition-opacity`,children:"Enviar"})]})]})}function T(){const[n,r]=d.useState("connecting"),[i,a]=d.useState({}),e=d.useRef(null),l=d.useRef(null),[x,o]=d.useState(0);d.useEffect(()=>{const s=new WebSocket(`ws://${window.location.hostname}:3000`);return e.current=s,s.onopen=()=>r("open"),s.onclose=()=>r("closed"),s.onerror=()=>r("error"),s.onmessage=({data:c})=>{try{const f=JSON.parse(c);a(m=>({...m,[f.agvId]:f}))}catch{console.error("Mensaje recibido no es JSON válido:",c)}},()=>s.close()},[]),d.useEffect(()=>{function s(){if(l.current){const c=l.current.getBoundingClientRect(),f=Math.min(c.width,c.height);o(f>0?f:0)}}return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]);const u=d.useCallback((s,c,f)=>{e.current?.send(JSON.stringify({agvId:s,target:{x:c,y:f}}))},[]),h=Object.values(i).sort((s,c)=>s.agvId-c.agvId).slice(0,24);return t.jsxs("div",{className:"w-screen h-screen bg-blue-900 flex flex-col overflow-hidden",children:[t.jsxs("header",{className:"w-full h-16 flex flex-col justify-center items-center",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-blue-200",children:"Moontech - Monitor AGVs"}),t.jsxs("div",{className:"text-base font-medium text-white mt-1",children:["WebSocket status:"," ",t.jsx("span",{className:n==="open"?"text-green-400":n==="connecting"?"text-yellow-400":n==="error"?"text-red-400":"text-gray-400",children:n})]})]}),t.jsx("div",{className:"flex-1 flex justify-center items-center overflow-hidden px-4 py-4",children:t.jsxs("div",{className:"flex w-full max-w-[1600px] h-full gap-6",children:[t.jsx("div",{ref:l,className:"flex-1 flex justify-center items-center bg-blue-900 rounded-lg p-4",children:x>0&&t.jsx(k,{agvs:i,mapSize:x})}),t.jsx("div",{className:"w-[500px] flex flex-col overflow-y-auto cards-scrollbar",children:t.jsx("div",{className:"grid grid-cols-2 gap-4 pr-2",children:h.map(s=>t.jsx(E,{agv:s,onSendTarget:u},s.agvId))})})]})})]})}export{T as default};
